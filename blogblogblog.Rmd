---
title: "blogblogblog"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r libraries, message=FALSE}
library(tidyverse)
library(jpeg)
library(readxl)
library(here)
library(brickr)
library(rayshader)
library(rgl)
library(circlepackeR)
library(data.tree)
library(treemap)
library(networkD3)
library(RColorBrewer)
library(ggraph)


rgl::setupKnitr()
```

```{r datasets, echo=FALSE}
sets <- read.csv(here("data/sets.csv"))

colors <- read.csv(here("data/colors (2).csv"))

inventories <- read.csv(here("data/inventories.csv"))

parts_inventory <- read.csv(here("data/inventory_parts.csv"))

sets_inventory <- read.csv(here("data/inventory_sets.csv"))

minifigs <- read.csv(here("data/minifigs.csv"))

parts_categories <- read.csv(here("data/part_categories.csv"))

parts_relationships <- read.csv(here("data/part_relationships.csv"))

parts <- read.csv(here("data/parts.csv"))

themes <- read.csv(here("data/themes.csv"))
```

```{r renaming variables}
colors <- rename(colors, "color_id"="id")

parts_categories <- rename(parts_categories, "part_cat_id"="id")
```

```{r hello kelly, rgl=TRUE, dev='png', warning=FALSE, message=FALSE, echo=FALSE, fig.align='center'}
#hello kelly

read_xlsx("~/Iggy-Izzy/data/brickr_pattern.xlsx", sheet = "hi") %>% 
  bricks_from_excel() %>% 
  build_bricks(rgl_lit = FALSE, outline_bricks = TRUE,
               background_color =  "#99e7ff")

par3d(userMatrix = rotate3d(par3d("userMatrix"), .1*pi, 0, 0 ,1))

par3d(windowRect = c(20, 30, 900, 800))
```

```{r izzy-iggy, rgl=TRUE, dev='png', echo=FALSE, warning=FALSE, message=FALSE, fig.align='center'}
#izzy-iggy

read_xlsx("~/Iggy-Izzy/data/brickr_pattern.xlsx", sheet = "izzy-iggy") %>% 
  bricks_from_excel() %>% 
  build_bricks(rgl_lit = FALSE, outline_bricks = TRUE,
               background_color =  "#99e7ff")

par3d(userMatrix = rotate3d(par3d("userMatrix"), .1*pi, 0, 0 ,1))

par3d(windowRect = c(20, 30, 900, 800))
```

```{r, rgl=TRUE, dev='png', echo=TRUE, warning=FALSE, message=FALSE, fig.align='center'}
#a cute little house!

read_xlsx("~/Iggy-Izzy/data/brickr_pattern.xlsx", sheet = "mybrickr") %>% 
  bricks_from_excel() %>% 
  build_bricks(rgl_lit = FALSE, outline_bricks = TRUE,
               background_color =  "#99e7ff")

par3d(userMatrix = rotate3d(par3d("userMatrix"), .1*pi, 0, 0 ,1))

par3d(windowRect = c(20, 30, 900, 800))
```




```{r wranglin sets & themes}
## wranglin 


smallthemes <- themes %>%
  select(id, name) %>%
  rename("theme_id"=id)

## dataset containing sets, themes, and number of parts 

sets_themes <- sets %>%
  filter(num_parts >= 40) %>%
  left_join(smallthemes, by="theme_id") %>%
  rename("set_name"=name.x, "theme_name"=name.y)


```

```{r, eval = TRUE}
## converting the data.frame to a data.tree structure
sets_themes$pathString <- paste("legos", 
                            sets_themes$theme_name,  
                            sets_themes$set_name,
                            sep = "/")
```


```{r, echo = FALSE}

# top 10 themes 
top_themes <- sets_themes %>%
  count(theme_name) %>% 
  top_n(10)

top_10_themes <- left_join(top_themes,sets_themes, by="theme_name")

# top 100 largest sets by number of parts 

large_sets <- top_10_themes %>%
  top_n(100, num_parts)

```

```{r}

## data tree structure! Neet!
large_sets <- as.Node(large_sets) 
print(large_sets, limit = 20)


 # within the top 10 themes these are the 100 sets with the most pieces. 
    large_sets_list <- ToListExplicit(large_sets, unname = TRUE)
    
## the best radial network 
    radialNetwork(large_sets_list)
      
      
```



```{r, echo = FALSE} 
##Keep this
# Circlepacker package

the_themes <- sets_themes %>%
  count(theme_name) %>%
  top_n(5)



sets_themes$pathString <- paste("legos", 
                            sets_themes$theme_name, 
                            sets_themes$set_name, 
                            sets_themes$num_parts,
                            sep = "/")


top_5_themes <- left_join(the_themes,sets_themes, by="theme_name") %>% 
  top_n(100, num_parts)

legos_circle <- as.Node(top_5_themes)
print(legos_circle, limit = 2-)

# Make the plot

 p <- circlepackeR(legos_circle, size = "num_parts", color_min = "hsl(56,80%,80%)", color_max = "hsl(341,30%,40%)", width = 1000, height = 800)

 p

```







```{r milf circlepackR}
#USC Millennium Falcon, 7541 parts, released 2017
#set num = 75192-1

inventories %>%
  filter(set_num == "75192-1")

millenium_falcon <- parts_inventory %>%
  filter(inventory_id == 19670) %>% #inventory ID gotten from previous step
  left_join(colors, by="color_id") %>%
  left_join(parts, by="part_num") %>%
  left_join(parts_categories, by="part_cat_id") %>%
  rename("part_cat"="name", "color_name"="name.x", "part_name"="name.y")

millenium_falcon$pathString <- paste("mf", 
                            millenium_falcon$color_name, 
                            millenium_falcon$part_cat,
                            millenium_falcon$part_name,
                            millenium_falcon$quantity,
                            sep = "/")

MILF <- as.Node(millenium_falcon)

#color, then part category, then part name, then part quantity
m <- circlepackeR(MILF, size = "quantity", width = 1000, height = 800)

m
```



```{r mosaics}

mosaic <- png::readPNG("iggy-izzy.png") %>% 
  image_to_mosaic(img_size = 80) 

mosaic%>% build_mosaic()



```



```{r millennium falcon image}
knitr::include_graphics(here("millenniumfalcon.png"))
```


```{r millennium falcon minifigs}
knitr::include_graphics(here("milf_minifigs.png"))
```

